import { PrismaClient, Direction, DayType, Prisma } from "@prisma/client";

const prisma = new PrismaClient();

type Entry = [mm: string, mark?: string];

// 戻り値の型を DepartureCreateManyInput[] に明示
function generateDepartures(
  dayType: DayType,
  direction: Direction,
  rows: Record<number, Entry[]>,
): Prisma.DepartureCreateManyInput[] {
  const mapDest: Record<string, string> = {
    犬: "犬山",
    岩: "岩倉",
    扶: "扶桑",
    浄: "浄心",
    豊: "豊田市",
  };
  const defaultDest = direction === "UP" ? "上小田井" : "赤池";
  return Object.entries(rows).flatMap(([hourStr, entries]) => {
    const hh = hourStr.padStart(2, "0");
    return entries.map(([mm, mark]) => {
      const isExpress = mark?.startsWith("*") ?? false;
      const key = mark?.replace("*", "") ?? "";
      return {
        direction,
        dayType,
        departureTime: `${hh}:${mm}`,
        destination: key ? (mapDest[key] ?? defaultDest) : defaultDest,
        note: isExpress ? "急行" : null,
      };
    });
  });
}

// 上り 平日 (WEEKDAY)
const upWeekday: Record<number, Entry[]> = {
  4: [],
  5: [["37"], ["49", "犬"], ["59"]],
  6: [
    ["07", "犬"],
    ["17"],
    ["25"],
    ["30", "*岩"],
    ["35", "*犬"],
    ["39"],
    ["44", "犬"],
    ["48"],
    ["53"],
    ["58"],
  ],
  7: [
    ["03", "*岩"],
    ["07"],
    ["12"],
    ["16", "岩"],
    ["21"],
    ["25", "*犬"],
    ["30"],
    ["34", "犬"],
    ["39"],
    ["43", "扶"],
    ["48"],
    ["52"],
    ["57"],
  ],
  8: [
    ["01"],
    ["06", "犬"],
    ["10"],
    ["15"],
    ["20"],
    ["25"],
    ["29"],
    ["34", "犬"],
    ["38"],
    ["43"],
    ["47", "岩"],
    ["53"],
    ["58"],
  ],
  9: [["04"], ["10"], ["16"], ["23"], ["29"], ["37"], ["44"], ["52"]],
  10: [["00"], ["08"], ["16"], ["25"], ["35"], ["45"], ["55"]],
  11: [["05"], ["15"], ["25"], ["35"], ["45"], ["55"]],
  12: [["05"], ["15"], ["25"], ["35"], ["45"], ["55"]],
  13: [["05"], ["15"], ["25"], ["35"], ["45"], ["55"]],
  14: [["05"], ["15"], ["25"], ["35"], ["45"], ["54"]],
  15: [["03"], ["11"], ["19"], ["26"], ["32"], ["38"], ["44"], ["50"], ["56"]],
  16: [
    ["02"],
    ["08"],
    ["14"],
    ["20"],
    ["26", "岩"],
    ["32"],
    ["38"],
    ["44"],
    ["50"],
    ["56", "岩"],
  ],
  17: [
    ["02"],
    ["08"],
    ["14"],
    ["20"],
    ["26", "岩"],
    ["32"],
    ["38"],
    ["44"],
    ["50"],
    ["56", "岩"],
  ],
  18: [
    ["02"],
    ["08"],
    ["14"],
    ["20"],
    ["26", "岩"],
    ["32"],
    ["38"],
    ["44"],
    ["50"],
    ["56", "岩"],
  ],
  19: [
    ["02"],
    ["08"],
    ["14"],
    ["21"],
    ["27", "岩"],
    ["35"],
    ["42"],
    ["50"],
    ["58", "岩"],
  ],
  20: [["08"], ["18"], ["28"], ["38"], ["48"], ["58"]],
  21: [["08"], ["18"], ["28"], ["38"], ["50"]],
  22: [["01"], ["13"], ["24"], ["37", "岩"], ["50"]],
  23: [["01", "犬"], ["12"], ["24"], ["40"], ["55"]],
  0: [["06", "浄"]],
  1: [],
  2: [],
  3: [],
};

// 上り 土日祝 (HOLIDAY)
const upHoliday: Record<number, Entry[]> = {
  4: [["04"]],
  5: [["37"], ["49", "犬"]],
  6: [["00"], ["11", "犬"], ["22"], ["32", "岩"], ["42"], ["51", "犬"], ["59"]],
  7: [
    ["07", "犬"],
    ["15", "岩"],
    ["22"],
    ["30", "犬"],
    ["37"],
    ["45", "岩"],
    ["52"],
  ],
  8: [
    ["00", "犬"],
    ["07"],
    ["15", "岩"],
    ["22"],
    ["30"],
    ["37"],
    ["45", "岩"],
    ["52"],
  ],
  9: [["00"], ["08", "岩"], ["18"], ["28", "岩"], ["38"], ["48"], ["58"]],
  10: [["08"], ["18"], ["27"], ["36"], ["45"], ["55"]],
  11: [["05"], ["15"], ["25"], ["35"], ["45"], ["55"]],
  12: [["05"], ["15"], ["25"], ["35"], ["45"], ["55"]],
  13: [["05"], ["15"], ["25"], ["35"], ["45"], ["55"]],
  14: [["05"], ["15"], ["25"], ["35"], ["45"], ["55"]],
  15: [["05"], ["15"], ["25"], ["35"], ["45"], ["55"]],
  16: [["05"], ["15"], ["25"], ["35"], ["45"], ["55"]],
  17: [["05"], ["15"], ["25"], ["35"], ["45"], ["55"]],
  18: [["05"], ["15"], ["25"], ["35"], ["45"], ["55"]],
  19: [["05"], ["15"], ["25"], ["35"], ["45"], ["55"]],
  20: [["05"], ["15"], ["25"], ["35"], ["45"], ["55"]],
  21: [["05"], ["15"], ["26"], ["38"], ["50"]],
  22: [["00", "犬"], ["13"], ["24"], ["37"], ["50", "岩"]],
  23: [["00"], ["12"], ["24"], ["40"], ["55"]],
  0: [["06", "浄"]],
  1: [],
  2: [],
  3: [],
};

// 下り 平日 (WEEKDAY)
const downWeekday: Record<number, Entry[]> = {
  6: [
    ["01", "豊"],
    ["13", "豊"],
    ["25", "豊"],
    ["37", "豊"],
    ["47", "豊"],
    ["58", "豊"],
  ],
  7: [
    ["09", "豊"],
    ["17", "豊"],
    ["25", "豊"],
    ["34", "豊"],
    ["43", "豊"],
    ["50"],
    ["55", "豊"],
  ],
  8: [
    ["00"],
    ["05", "豊"],
    ["09"],
    ["14"],
    ["19", "豊"],
    ["24"],
    ["28", "豊"],
    ["32", "豊"],
    ["36", "豊"],
    ["41", "豊"],
    ["45", "豊"],
    ["50"],
    ["54"],
    ["59", "豊"],
  ],
  9: [
    ["03"],
    ["08"],
    ["13", "豊"],
    ["17"],
    ["22"],
    ["26"],
    ["31"],
    ["35"],
    ["40"],
    ["44"],
    ["49"],
    ["54"],
    ["58"],
  ],
  10: [
    ["02"],
    ["07"],
    ["11", "豊"],
    ["16"],
    ["20"],
    ["25"],
    ["30"],
    ["35"],
    ["41"],
    ["46"],
    ["54"],
  ],
  11: [
    ["02"],
    ["10", "豊"],
    ["18"],
    ["26", "豊"],
    ["33"],
    ["43", "豊"],
    ["53"],
  ],
  12: [["03"], ["13", "豊"], ["23"], ["33"], ["43", "豊"], ["53"]],
  13: [["03"], ["13", "豊"], ["23"], ["33"], ["43", "豊"], ["53"]],
  14: [["03"], ["13", "豊"], ["23"], ["33"], ["43", "豊"], ["53"]],
  15: [["03"], ["13", "豊"], ["23"], ["33"], ["43", "豊"], ["53"]],
  16: [
    ["03"],
    ["12"],
    ["19", "豊"],
    ["27"],
    ["34", "豊"],
    ["42"],
    ["49", "豊"],
    ["56", "豊"],
  ],
  17: [
    ["02"],
    ["08"],
    ["14", "豊"],
    ["20"],
    ["26", "豊"],
    ["32"],
    ["38"],
    ["44", "豊"],
    ["50"],
    ["56", "豊"],
  ],
  18: [
    ["02"],
    ["08"],
    ["14", "豊"],
    ["20"],
    ["26", "豊"],
    ["32"],
    ["38", "豊"],
    ["44"],
    ["50", "豊"],
    ["56", "豊"],
  ],
  19: [
    ["02", "豊"],
    ["08", "豊"],
    ["14", "豊"],
    ["20", "豊"],
    ["26", "豊"],
    ["32", "豊"],
    ["38", "豊"],
    ["44", "豊"],
    ["50", "豊"],
    ["56", "豊"],
  ],
  20: [
    ["02"],
    ["08"],
    ["14", "豊"],
    ["20"],
    ["27", "豊"],
    ["35", "豊"],
    ["43", "豊"],
    ["50", "豊"],
    ["58", "豊"],
  ],
  21: [
    ["06"],
    ["14", "豊"],
    ["23", "豊"],
    ["33", "豊"],
    ["43", "豊"],
    ["53", "豊"],
  ],
  22: [["03"], ["13", "豊"], ["24"], ["35", "豊"], ["47", "豊"], ["59", "豊"]],
  23: [["11", "豊"], ["22"], ["34"], ["45", "豊"], ["58", "豊"]],
  0: [["11"], ["22"]],
};

// 下り 土日祝 (HOLIDAY)
const downHoliday: Record<number, Entry[]> = {
  6: [["01", "豊"], ["13", "豊"], ["24"], ["36", "豊"], ["47", "豊"], ["58"]],
  7: [
    ["07", "豊"],
    ["17", "豊"],
    ["28", "豊"],
    ["38", "豊"],
    ["48", "豊"],
    ["58", "豊"],
  ],
  8: [
    ["08", "豊"],
    ["16"],
    ["25", "豊"],
    ["34", "豊"],
    ["41", "豊"],
    ["49", "豊"],
    ["56", "豊"],
  ],
  9: [
    ["04"],
    ["11", "豊"],
    ["19", "豊"],
    ["27", "豊"],
    ["34", "豊"],
    ["41", "豊"],
    ["48", "豊"],
    ["56", "豊"],
  ],
  10: [
    ["03"],
    ["11", "豊"],
    ["18"],
    ["26", "豊"],
    ["33"],
    ["43", "豊"],
    ["53", "豊"],
  ],
  11: [["03"], ["13", "豊"], ["23"], ["33"], ["43", "豊"], ["53", "豊"]],
  12: [["03"], ["13", "豊"], ["23"], ["33"], ["43", "豊"], ["53", "豊"]],
  13: [["03"], ["13", "豊"], ["23"], ["33"], ["43", "豊"], ["53", "豊"]],
  14: [["03"], ["13", "豊"], ["23"], ["33"], ["43", "豊"], ["53", "豊"]],
  15: [["03"], ["13", "豊"], ["23"], ["33"], ["43", "豊"], ["53", "豊"]],
  16: [["03"], ["13", "豊"], ["23"], ["33"], ["43", "豊"], ["53", "豊"]],
  17: [["03"], ["13", "豊"], ["23"], ["33"], ["43", "豊"], ["53", "豊"]],
  18: [["03"], ["13", "豊"], ["23"], ["33"], ["43", "豊"], ["53", "豊"]],
  19: [["03"], ["13", "豊"], ["23"], ["33"], ["43", "豊"], ["53", "豊"]],
  20: [["03"], ["13", "豊"], ["23"], ["33"], ["43", "豊"], ["53", "豊"]],
  21: [["03"], ["13", "豊"], ["23"], ["33"], ["43", "豊"], ["53", "豊"]],
  22: [["03"], ["13", "豊"], ["24"], ["36"], ["47", "豊"], ["59", "豊"]],
  23: [["11"], ["22", "豊"], ["34"], ["45", "豊"], ["58"]],
  0: [["11"], ["22"]],
};

// 実際のシード投入用データを一気に作る
const seedData = [
  ...generateDepartures("WEEKDAY", "UP", upWeekday),
  ...generateDepartures("HOLIDAY", "UP", upHoliday),
  ...generateDepartures("WEEKDAY", "DOWN", downWeekday),
  ...generateDepartures("HOLIDAY", "DOWN", downHoliday),
];

async function main(): Promise<void> {
  try {
    console.log(`Seeding ${seedData.length} departure records...`);
    await prisma.departure.createMany({ data: seedData });
    console.log('Seeding completed successfully');
  } catch (e) {
    console.error('Seeding failed:', e);
  } finally {
    await prisma.$disconnect();
  }
}

main();
